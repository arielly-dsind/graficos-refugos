<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>DS - Dashboard OEE</title>
<link rel="icon" type="image/png" href="logo.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--vermelho:#c40000;
--grafite:#1f1f1f;
--cinza:#f4f6f9;
--card:#2a2a2a;
}

body{
margin:0;
font-family:Arial;
background:var(--grafite);
color:white;
transition:0.3s;
}

header{
display:flex;
justify-content:space-between;
align-items:center;
padding:15px 30px;
background:#2a2a2a;
box-shadow:0 2px 5px rgba(0,0,0,0.4);
}

.logo-area{
display:flex;
align-items:center;
gap:15px;
}

.logo-area img{
height:40px;
}

button{
padding:10px 18px;
border:none;
background:var(--vermelho);
color:white;
border-radius:6px;
cursor:pointer;
margin:5px 5px 5px 0;
font-weight:bold;
}

.toggle{
background:#444;
}

.container{
padding:30px 40px;
}

textarea{
width:100%;
height:130px;
padding:10px;
border-radius:8px;
border:1px solid #444;
background:#333;
color:white;
}

.filtros{
display:flex;
gap:20px;
flex-wrap:wrap;
margin:20px 0;
}

select,input{
padding:8px;
border-radius:6px;
border:1px solid #444;
background:#333;
color:white;
}

.cards{
display:flex;
gap:20px;
flex-wrap:wrap;
margin:30px 0;
}

.card{
background:var(--card);
padding:20px;
border-radius:10px;
min-width:200px;
box-shadow:0 3px 8px rgba(0,0,0,0.4);
}

canvas{
background:#2a2a2a;
border-radius:10px;
padding:15px;
margin-bottom:40px;
}

.light{
background:var(--cinza);
color:black;
}

.light header{background:white;}
.light textarea,.light select,.light input{background:white;color:black;border:1px solid #ccc;}
.light canvas{background:white;}
.light .card{background:white;}
</style>
</head>

<body>

<header>
<div class="logo-area">
<img src="logo.png">
<h2>Dashboard OEE</h2>
<button onclick="voltar()">⬅ Voltar</button>
</div>
<button class="toggle" onclick="alternarModo()">☀️</button>
</header>

<div class="container">

<textarea id="entrada" placeholder="Cole os dados separados por TAB"></textarea>
<br><br>
<button onclick="processar()">Gerar Relatório</button>

<div class="filtros">
<div>
<label>Data Inicial</label><br>
<input type="date" id="dataIni" onchange="atualizar()">
</div>

<div>
<label>Data Final</label><br>
<input type="date" id="dataFim" onchange="atualizar()">
</div>

<div>
<label>Recurso</label><br>
<select id="filtroRecurso" onchange="atualizar()">
<option value="todos">Todos</option>
</select>
</div>

<div>
<label>Operador</label><br>
<select id="filtroOperador" onchange="atualizar()">
<option value="todos">Todos</option>
</select>
</div>
</div>

<div class="cards">
<div class="card" id="velPadraoCard">Velocidade Padrão Média<br><b>0</b></div>
<div class="card" id="velRealCard">Velocidade Real Média<br><b>0</b></div>
</div>

<h2>Média por Recurso</h2>
<canvas id="grafRecurso"></canvas>

<h2>Média por Operador</h2>
<canvas id="grafOperador"></canvas>

</div>

<script>

let dados=[];
let graficos={};

function voltar(){window.location.href="index.html";}
function alternarModo(){document.body.classList.toggle("light");}

function normalizar(v){
if(!v)return 0;
v=v.replace("%","").replace(",",".");
v=Number(v);
if(v>1)v=v/100;
return v;
}

function processar(){

dados=[];
const texto=document.getElementById("entrada").value.trim();
if(!texto)return alert("Cole os dados");

let linhas=texto.split("\n");

linhas.forEach(l=>{
let c=l.split("\t");
if(c.length<9)return;

dados.push({
data:c[0],
recurso:c[1],
operador:c[2],
velPadrao:Number(c[3].replace(",",".")),
velReal:Number(c[4].replace(",",".")),
performance:normalizar(c[5]),
qualidade:normalizar(c[6]),
disponibilidade:normalizar(c[7])
});
});

popularFiltros();
atualizar();
}

function popularFiltros(){
let recursos=[...new Set(dados.map(d=>d.recurso))];
let operadores=[...new Set(dados.map(d=>d.operador))];

let fr=document.getElementById("filtroRecurso");
let fo=document.getElementById("filtroOperador");

fr.innerHTML='<option value="todos">Todos</option>';
fo.innerHTML='<option value="todos">Todos</option>';

recursos.forEach(r=>fr.innerHTML+=`<option>${r}</option>`);
operadores.forEach(o=>fo.innerHTML+=`<option>${o}</option>`);
}

function atualizar(){

let ini=document.getElementById("dataIni").value;
let fim=document.getElementById("dataFim").value;
let fr=document.getElementById("filtroRecurso").value;
let fo=document.getElementById("filtroOperador").value;

let filtrado=dados.filter(d=>{
return (!ini||d.data>=ini)
&& (!fim||d.data<=fim)
&& (fr==="todos"||d.recurso===fr)
&& (fo==="todos"||d.operador===fo);
});

calcularVelocidades(filtrado);
gerarGrafico("grafRecurso","recurso",filtrado);
gerarGrafico("grafOperador","operador",filtrado);
}

function calcularVelocidades(lista){
if(lista.length===0)return;

let vp=lista.reduce((s,d)=>s+d.velPadrao,0)/lista.length;
let vr=lista.reduce((s,d)=>s+d.velReal,0)/lista.length;

document.getElementById("velPadraoCard").innerHTML=
`Velocidade Padrão Média<br><b>${vp.toFixed(2)}</b>`;

document.getElementById("velRealCard").innerHTML=
`Velocidade Real Média<br><b>${vr.toFixed(2)}</b>`;
}

function gerarGrafico(id,campo,lista){

let mapa={};

lista.forEach(d=>{
if(!mapa[d[campo]]){
mapa[d[campo]]={p:0,q:0,d:0,c:0};
}
mapa[d[campo]].p+=d.performance;
mapa[d[campo]].q+=d.qualidade;
mapa[d[campo]].d+=d.disponibilidade;
mapa[d[campo]].c++;
});

let labels=Object.keys(mapa);

let perf=[],qual=[],disp=[];

labels.forEach(l=>{
perf.push((mapa[l].p/mapa[l].c)*100);
qual.push((mapa[l].q/mapa[l].c)*100);
disp.push((mapa[l].d/mapa[l].c)*100);
});

if(graficos[id])graficos[id].destroy();

graficos[id]=new Chart(document.getElementById(id),{
type:"bar",
data:{
labels:labels,
datasets:[
{label:"Performance",data:perf,backgroundColor:"#c40000"},
{label:"Qualidade",data:qual,backgroundColor:"#666"},
{label:"Disponibilidade",data:disp,backgroundColor:"#999"}
]
},
options:{responsive:true,scales:{y:{max:100}}}
});
}

</script>
</body>
</html>
