<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>DS - Dashboard OEE</title>
<link rel="icon" type="image/png" href="logo.png?v=6">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--vermelho:#c40000;
--azul:#007bff;
--verde:#28a745;
--grafite:#121212;
--grafiteCard:#1f1f1f;
--claro:#f4f6f9;
}

body{
margin:0;
font-family:Arial;
background:var(--grafite);
color:white;
display:flex;
height:100vh;
overflow:hidden;
transition:0.3s;
}

.light{
background:var(--claro);
color:black;
}

/* SIDEBAR */

.sidebar{
width:250px;
background:#000;
padding:20px;
display:flex;
flex-direction:column;
transition:0.3s;
}

.sidebar.collapsed{
width:70px;
padding:20px 10px;
}

.sidebar h2{
color:var(--vermelho);
margin-top:0;
}

.menu-item{
padding:12px;
margin-bottom:10px;
cursor:pointer;
border-radius:6px;
background:#1f1f1f;
transition:0.2s;
}

.menu-item:hover{
background:var(--vermelho);
}

.sidebar.collapsed .menu-item{
display:none;
}

/* CONTENT */

.content{
flex:1;
display:flex;
flex-direction:column;
transition:0.3s;
}

header{
display:flex;
align-items:center;
padding:15px 30px;
background:#000;
}

.menu-toggle{
font-size:22px;
cursor:pointer;
margin-right:15px;
min-width:30px;
}

header h2{
color:var(--vermelho);
margin:0;
}

.header-right{
margin-left:auto;
display:flex;
gap:10px;
}

button{
padding:8px 15px;
background:var(--vermelho);
color:white;
border:none;
border-radius:6px;
cursor:pointer;
}

.toggle{
background:#333;
}

.container{
padding:30px 40px;
overflow:auto;
flex:1;
}

.card{
background:var(--grafiteCard);
padding:20px;
border-radius:10px;
margin-bottom:20px;
}

textarea,select,input{
width:100%;
padding:8px;
border-radius:6px;
border:none;
background:#2a2a2a;
color:white;
margin-bottom:10px;
}

canvas{
background:var(--grafiteCard);
padding:15px;
border-radius:10px;
margin-bottom:40px;
}

/* LIGHT MODE */

.light .sidebar{background:#eaeaea;}
.light .menu-item{background:white;color:black;}
.light header{background:white;}
.light textarea,
.light select,
.light input{background:white;color:black;border:1px solid #ccc;}
.light .card,
.light canvas{background:white;color:black;}
</style>
</head>

<body>

<div class="sidebar" id="sidebar">
<h2>DS</h2>
<div class="menu-item" onclick="selecionarSetor('injetora')">INJETORA</div>
<div class="menu-item" onclick="selecionarSetor('usinagem')">USINAGEM</div>
<div class="menu-item" onclick="selecionarSetor('estampagem')">ESTAMPAGEM</div>
</div>

<div class="content">

<header>
<div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
<h2>Dashboard OEE</h2>

<div class="header-right">
<button onclick="irTelaInicial()">TELA INICIAL</button>
<button class="toggle" onclick="alternarModo()">‚òÄÔ∏è</button>
</div>
</header>

<div class="container" id="conteudo">

<div class="card">
<h3>Selecione um setor</h3>
<p>
Este dashboard foi desenvolvido para an√°lise gr√°fica dos indicadores de OEE por setor.
Selecione um setor no menu lateral para visualizar os dados.
</p>
</div>

</div>

</div>

<script>

let dados=[];
let dadosFiltrados=[];
let graficos={};

function irTelaInicial(){
window.location.href="index.html";
}

function alternarModo(){
document.body.classList.toggle("light");
}

function toggleMenu(){
document.getElementById("sidebar").classList.toggle("collapsed");
}

function selecionarSetor(setor){

document.getElementById("sidebar").classList.add("collapsed");

if(setor==="injetora"){
document.getElementById("conteudo").innerHTML = gerarDashboardHTML();
}else{
document.getElementById("conteudo").innerHTML = `
<div class="card">
<h3>üöß Setor em desenvolvimento</h3>
<p>Estamos desenvolvendo os indicadores deste setor.</p>
<button onclick="toggleMenu()">Abrir Menu</button>
</div>
`;
}

}

function gerarDashboardHTML(){
return `
<div class="card">
<textarea id="entrada" placeholder="Cole os dados respeitando as 9 colunas"></textarea>
<button onclick="processar()">Gerar Relat√≥rio</button>
</div>

<div class="card">
<label>Data Inicial</label>
<input type="date" id="fDataInicio">
<label>Data Final</label>
<input type="date" id="fDataFim">
<label>Operador</label>
<select id="fOperador"><option value="">Todos</option></select>
<label>M√°quina</label>
<select id="fRecurso"><option value="">Todos</option></select>
<button onclick="aplicarFiltros()">Aplicar</button>
<button onclick="limparFiltros()">Limpar</button>
</div>

<div class="card">
Velocidade Padr√£o M√©dia: <b id="velPadrao">0</b><br>
Velocidade Real M√©dia: <b id="velReal">0</b>
</div>

<h3>M√©dia Performance / Qualidade / Disponibilidade por M√°quina</h3>
<canvas id="grafRecurso"></canvas>

<h3>M√©dia Performance / Qualidade / Disponibilidade por Operador</h3>
<canvas id="grafOperador"></canvas>
`;
}

function parseData(t){
const [d,m,a]=t.split("/");
return new Date(`${a}-${m}-${d}`);
}

function normalizar(v){
if(!v)return 0;
v=v.replace("%","").replace(",",".");
v=Number(v);
if(v>1)v=v/100;
return v;
}

function processar(){

dados=[];
const texto=document.getElementById("entrada").value.trim();
if(!texto)return alert("Cole os dados");

texto.split("\n").forEach(l=>{
const c=l.split("\t");
if(c.length<9)return;

dados.push({
data:parseData(c[0]),
recurso:c[1],
operador:c[2],
velPadrao:Number(c[3].replace(",", ".")),
velReal:Number(c[4].replace(",", ".")),
performance:normalizar(c[5]),
qualidade:normalizar(c[6]),
disponibilidade:normalizar(c[7])
});
});

popularFiltros();
dadosFiltrados=[...dados];
atualizar();
}

function popularFiltros(){
popularSelect("fOperador","operador");
popularSelect("fRecurso","recurso");
}

function popularSelect(id,campo){
const select=document.getElementById(id);
const valores=[...new Set(dados.map(d=>d[campo]))].sort();
select.innerHTML='<option value="">Todos</option>';
valores.forEach(v=>{
select.innerHTML+=`<option value="${v}">${v}</option>`;
});
}

function aplicarFiltros(){
const ini=document.getElementById("fDataInicio").value;
const fim=document.getElementById("fDataFim").value;
const op=document.getElementById("fOperador").value;
const maq=document.getElementById("fRecurso").value;

dadosFiltrados=dados.filter(d=>{
if(ini && d.data < new Date(ini)) return false;
if(fim && d.data > new Date(fim+"T23:59:59")) return false;
if(op && d.operador!==op) return false;
if(maq && d.recurso!==maq) return false;
return true;
});

atualizar();
}

function limparFiltros(){
document.getElementById("fDataInicio").value="";
document.getElementById("fDataFim").value="";
document.getElementById("fOperador").value="";
document.getElementById("fRecurso").value="";
dadosFiltrados=[...dados];
atualizar();
}

function atualizar(){

const velP=dadosFiltrados.reduce((s,d)=>s+d.velPadrao,0)/dadosFiltrados.length||0;
const velR=dadosFiltrados.reduce((s,d)=>s+d.velReal,0)/dadosFiltrados.length||0;

document.getElementById("velPadrao").innerText=velP.toFixed(2);
document.getElementById("velReal").innerText=velR.toFixed(2);

gerarGrafico("grafRecurso","recurso");
gerarGrafico("grafOperador","operador");
}

function gerarGrafico(id,campo){

let mapa={};

dadosFiltrados.forEach(d=>{
if(!mapa[d[campo]]){
mapa[d[campo]]={p:0,q:0,d:0,c:0};
}
mapa[d[campo]].p+=d.performance;
mapa[d[campo]].q+=d.qualidade;
mapa[d[campo]].d+=d.disponibilidade;
mapa[d[campo]].c++;
});

let labels=Object.keys(mapa);
let perf=[],qual=[],disp=[];

labels.forEach(l=>{
perf.push((mapa[l].p/mapa[l].c)*100);
qual.push((mapa[l].q/mapa[l].c)*100);
disp.push((mapa[l].d/mapa[l].c)*100);
});

if(graficos[id])graficos[id].destroy();

graficos[id]=new Chart(document.getElementById(id),{
type:"bar",
data:{
labels:labels,
datasets:[
{label:"Performance",data:perf,backgroundColor:"#007bff"},
{label:"Qualidade",data:qual,backgroundColor:"#c40000"},
{label:"Disponibilidade",data:disp,backgroundColor:"#28a745"}
]
},
options:{
responsive:true,
scales:{y:{max:100}},
plugins:{legend:{position:"top"}}
}
});
}

</script>
</body>
</html>
