<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard de Refugos</title>

<link rel="icon" type="image/png" href="favicon.png">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ====== VARI츼VEIS DE TEMA ====== */
:root{
--bg: #f4f6f9;
--card: #ffffff;
--text: #1f2937;
--primary: #2563eb;
--shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.dark{
--bg: #0f172a;
--card: #1e293b;
--text: #f1f5f9;
--primary: #3b82f6;
--shadow: 0 4px 12px rgba(0,0,0,0.4);
}

body{
font-family: 'Segoe UI', Arial, sans-serif;
margin:0;
padding:25px;
background:var(--bg);
color:var(--text);
transition:0.3s;
}

/* ====== HEADER ====== */
.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:20px;
}

h1{
margin:0;
font-weight:600;
}

/* ====== BOT츾O DARK MODE ====== */
.toggle{
background:var(--primary);
color:white;
border:none;
padding:8px 14px;
border-radius:20px;
cursor:pointer;
font-size:14px;
transition:0.3s;
}

.toggle:hover{
opacity:0.85;
}

/* ====== TEXTAREA ====== */
textarea{
width:100%;
height:160px;
border-radius:8px;
padding:10px;
border:1px solid #ccc;
resize:none;
}

/* ====== BOXES ====== */
.box{
background:var(--card);
padding:18px;
border-radius:12px;
box-shadow:var(--shadow);
}

.kpis, .filtros{
display:flex;
gap:20px;
flex-wrap:wrap;
margin:20px 0;
}

/* ====== BOT칏ES ====== */
button{
padding:10px 18px;
border:none;
background:var(--primary);
color:white;
border-radius:8px;
cursor:pointer;
transition:0.3s;
}

button:hover{
opacity:0.85;
}

/* ====== CANVAS ====== */
canvas{
background:var(--card);
padding:15px;
border-radius:12px;
box-shadow:var(--shadow);
margin-bottom:35px;
}

/* Inputs */
input{
padding:8px;
border-radius:6px;
border:1px solid #ccc;
}

</style>
</head>

<body>

<div class="header">
<h1>Dashboard de Refugos</h1>
<button class="toggle" onclick="alternarTema()">游깿 Modo Noturno</button>
</div>

<textarea id="entrada"
placeholder="Cole aqui os dados do Excel respeitando as 11 colunas">
</textarea>
<br><br>
<button onclick="processar()">Gerar Relat칩rio</button>

<div class="filtros box">
<div>
<label>Data Inicial</label><br>
<input type="date" id="dataInicio">
</div>

<div>
<label>Data Final</label><br>
<input type="date" id="dataFim">
</div>

<div style="align-self:end">
<button onclick="aplicarFiltro()">Aplicar Filtro</button>
</div>
</div>

<div class="kpis">
<div class="box">Total Registros<br><b id="kpiRegistros">0</b></div>
<div class="box">Total Quantidade<br><b id="kpiQuantidade">0</b></div>
</div>

<h2>칈ndice por Linha do Produto</h2>
<canvas id="grafLinha"></canvas>

<h2>칈ndice por Classifica칞칚o</h2>
<canvas id="grafClassificacao"></canvas>

<h2>칈ndice por Nome do Refugo</h2>
<canvas id="grafRefugo"></canvas>

<h2>칈ndice por C칩digo do Produto</h2>
<canvas id="grafProduto"></canvas>

<h2>칈ndice por Usu치rio (Operador)</h2>
<canvas id="grafUsuario"></canvas>

<script>

let dados = [];
let dadosFiltrados = [];
let graficos = {};

function alternarTema(){
document.body.classList.toggle("dark");
atualizar(); // atualiza gr치ficos com nova cor
}

function parseData(texto){
const [data,hora] = texto.split(" ");
const [d,m,a] = data.split("/");
return new Date(`${a}-${m}-${d}T${hora||"00:00:00"}`);
}

function processar(){
const texto = document.getElementById("entrada").value.trim();
if(!texto) return alert("Cole os dados");

dados = [];

texto.split("\n").forEach(linha=>{
const c = linha.split("\t");
if(c.length < 11) return;

dados.push({
data: parseData(c[0]),
recurso: c[1],
usuario: c[2],
ordem: c[3],
codProduto: c[4],
nomeProduto: c[5],
quantidade: Number(c[6].replace(",", ".")),
codRefugo: c[7],
nomeRefugo: c[8],
classificacao: c[9],
linhaProduto: c[10]
});
});

dadosFiltrados = [...dados];
atualizar();
}

function aplicarFiltro(){
const ini = document.getElementById("dataInicio").value;
const fim = document.getElementById("dataFim").value;

dadosFiltrados = dados.filter(d=>{
if(!d.data) return false;
if(ini && d.data < new Date(ini)) return false;
if(fim && d.data > new Date(fim+"T23:59:59")) return false;
return true;
});

atualizar();
}

function atualizar(){
document.getElementById("kpiRegistros").innerText = dadosFiltrados.length;
document.getElementById("kpiQuantidade").innerText =
dadosFiltrados.reduce((s,d)=>s+d.quantidade,0);

gerarGrafico("grafLinha","linhaProduto");
gerarGrafico("grafClassificacao","classificacao");
gerarGrafico("grafRefugo","nomeRefugo");
gerarGrafico("grafProduto","codProduto");
gerarGrafico("grafUsuario","usuario");
}

function gerarGrafico(canvasId, campo){

const mapa = {};
dadosFiltrados.forEach(d=>{
mapa[d[campo]] = (mapa[d[campo]]||0) + d.quantidade;
});

const labels = Object.keys(mapa);
const valores = Object.values(mapa);

if(graficos[canvasId]) graficos[canvasId].destroy();

const corTexto = getComputedStyle(document.body).getPropertyValue('--text');

graficos[canvasId] = new Chart(document.getElementById(canvasId),{
type:"bar",
data:{
labels:labels,
datasets:[{
label:"Quantidade",
data:valores,
backgroundColor:getComputedStyle(document.body).getPropertyValue('--primary')
}]
},
options:{
responsive:true,
plugins:{
legend:{display:false}
},
scales:{
x:{ticks:{color:corTexto}},
y:{ticks:{color:corTexto}}
}
}
});
}

</script>

</body>
</html>
